# ü§ñ SOC Automation Project

---

## üìå Overview

This project demonstrates a fully automated SOC detection and response workflow.

It simulates **Mimikatz credential dumping activity** on a Windows 10 endpoint and automatically:

- Detects execution using **Sysmon + Wazuh**
- Forwards alerts via **Webhook integration**
- Extracts the **SHA256 hash**
- Enriches the indicator using **VirusTotal**
- Creates an alert in **TheHive**
- Sends a confirmation **email notification**

The objective was to design and build a realistic SOC pipeline that mirrors how enterprise environments automate detection, enrichment, and escalation.

---

## üß± Architecture

```
Windows 10 (Sysmon)
        ‚Üì
Wazuh Agent
        ‚Üì
Wazuh Manager (Vultr Cloud)
        ‚Üì (Rule 100002 Webhook)
Shuffle SOAR
        ‚Üì Hash Extraction
        ‚Üì VirusTotal Enrichment
        ‚Üì TheHive Alert Creation
        ‚Üì Email Notification
```

This structure separates:

- Endpoint telemetry  
- Detection logic  
- Automation  
- Enrichment  
- Case management  
- Analyst notification  

---

## üõ† Environment Built

### Endpoint
- Windows 10 VM (VirtualBox)
- Sysmon installed & configured

### Cloud Infrastructure
- Wazuh Manager (Vultr)
- TheHive (Vultr)

### Automation & Enrichment
- Shuffle SOAR
- VirusTotal API v3

---

## üß† Detection Engineering

### Custom Wazuh Rule

```xml
<rule id="100002" level="15">
  <if_group>sysmon_event1</if_group>
  <field name="win.eventdata.originalFileName" type="pcre2">(?i)mimikatz\.exe</field>
  <mitre>
    <id>T1003</id>
  </mitre>
</rule>
```

**Detection Logic Explained:**

- Monitors Sysmon Process Creation (Event ID 1)
- Identifies execution of `mimikatz.exe`
- Maps to MITRE ATT&CK **T1003 ‚Äì Credential Dumping**
- High severity alert (15)

This represents a high-confidence credential access detection.

---

## üîó SIEM ‚Üí SOAR Integration

Configured in `ossec.conf`:

```xml
<integration>
  <name>shuffle</name>
  <hook_url>https://shuffler.io/api/v1/hooks/webhook_xxxxx</hook_url>
  <rule_id>100002</rule_id>
  <alert_format>json</alert_format>
</integration>
```

Only Rule **100002** alerts are forwarded to Shuffle in structured JSON format.

---

## ü§ñ Automation Workflow

### 1Ô∏è‚É£ SHA256 Extraction

```regex
SHA256=([0-9A-Fa-f]{64})
```

Used to extract the file hash directly from Wazuh alert data.

---

### 2Ô∏è‚É£ Threat Intelligence Enrichment

- VirusTotal API v3
- Hash reputation lookup
- Adds context before escalation

---

### 3Ô∏è‚É£ TheHive Alert Creation

Initial issue:

```
Alert already exists
```

Cause:
TheHive rejected duplicate `sourceRef` values.

### ‚úÖ Fix Implemented

```json
"sourceRef": "{{ exec.rule_id }}-{{ shuffle.execution_id }}"
```

Each alert now has a unique identifier.

---

## üß© Issues Resolved

| Issue | Cause | Resolution |
|-------|--------|------------|
| Wazuh dashboard not loading | Port 443 blocked | Allowed HTTPS traffic |
| Duplicate TheHive alerts | Identical sourceRef | Added execution_id |
| JSON formatting error | Incorrect structure | Corrected syntax |

---

## üöÄ Skills Demonstrated

- Detection Engineering  
- SIEM Configuration  
- MITRE ATT&CK Mapping  
- SOAR Workflow Development  
- API Integration  
- Cloud Deployment  
- Incident Escalation Design  
- Debugging & Troubleshooting  

---

## üì∏ Screenshots

- Architecture diagram  
- Wazuh service validation  
- Custom rule configuration  
- Shuffle workflow  
- SHA256 extraction  
- VirusTotal enrichment  
- TheHive success  
- Email confirmation  

---

## ‚úÖ Outcome

A working SOC automation pipeline capable of:

- Detecting credential dumping activity  
- Enriching indicators automatically  
- Escalating to case management  
- Notifying analysts in real time  

Built in a realistic lab environment using enterprise-style tooling.

