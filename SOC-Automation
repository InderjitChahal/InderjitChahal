# Indy SOC Automation Project â€” Wazuh âœ Shuffle âœ VirusTotal âœ TheHive âœ Email

A SOC automation pipeline that detects suspicious Windows activity (example: **Mimikatz usage**) in **Wazuh**, forwards matching alerts to **Shuffle (SOAR)**, extracts/enriches IOCs via **VirusTotal**, creates an alert in **TheHive**, and sends an **email notification** to the analyst.

> âš ï¸ **Before publishing:** redact public IPs, webhook URLs, API keys, and any host/usernames if required by your course/company policy.

---

## ğŸ”­ What this project demonstrates
- Cloud-hosted **Wazuh** and **TheHive** (Vultr) working together with **Shuffle**
- Custom **Wazuh local rule** to detect a Sysmon-based Mimikatz indicator (MITRE: **T1003**)
- Wazuh â†’ Shuffle webhook integration (filtered to a specific `rule_id`)
- Regex extraction of **SHA256** from incoming Wazuh alert payload
- Threat intel enrichment using **VirusTotal v3** â€œGet a hash reportâ€
- Automated case/alert creation in **TheHive** with proper de-duplication handling
- Email notification to confirm the automation chain works end-to-end

---

## ğŸ§± Architecture

![SOC Automation Architecture](images/planning_of_SOC_automation.jpg)

**Flow (high-level):**
1. Windows 10 client generates telemetry (Sysmon)
2. Wazuh agent forwards events to Wazuh manager
3. Wazuh triggers an alert when rule conditions match (e.g., Mimikatz)
4. Wazuh forwards alert to Shuffle (webhook integration)
5. Shuffle extracts SHA256 and enriches it in VirusTotal
6. Shuffle creates a TheHive alert/case and sends an email notification

---

## ğŸ› ï¸ Tech Stack
- **Windows 10 VM** (VirtualBox)
- **Sysmon** (Windows telemetry)
- **Wazuh** (Manager + Indexer + Dashboard)
- **Shuffle** (SOAR workflow engine)
- **VirusTotal API v3** (hash enrichment)
- **TheHive** (alert & case management)
- **Vultr** (cloud hosting for Wazuh + TheHive)

---

## âœ… Deployment Evidence (Screenshots)
Add your screenshots to an `images/` folder in this repo and keep the names consistent with the list below.

| Step | Screenshot |
|------|------------|
| Planned architecture (draw.io) | `images/planning_of_SOC_automation.jpg` |
| Vultr instances for Wazuh + TheHive | `images/vultr_installation_of_hive_and_wazuh.png` |
| Wazuh running (systemctl status) | `images/wazuh_running.png` |
| Sysmon logs visible in Wazuh discover | `images/Screenshot_2026-02-11_210025.png` |
| Custom Wazuh local rule | `images/creating_custom_rule.png` |
| Wazuh integration in `ossec.conf` (Shuffle webhook + rule id) | `images/ossec_config_files.png` |
| Rule fired: â€œMimikatz Usage Detectedâ€ | `images/mimikatz_usage_detected.png` |
| Shuffle listens for Wazuh alerts (rule_id 100002) | `images/lisening_on_any_alerts_were_rule_id_is_100002.png` |
| Regex capture group (SHA256 extraction) | `images/Screenshot_2026-02-11_184639.png` |
| VirusTotal hash report step | `images/Screenshot_2026-02-11_185611.png` |
| VT output successful | `images/virus_total_performing_correctly_on_shuffle.png` |
| TheHive alert creation (JSON error then fixed) | `images/thehive_on_shuffler_didnt_execute_properly_cux_of_Json_error.png` |
| TheHive alert creation (working / 201) | `images/thehive_on_shuffler_sucesfully_working.png` |
| Email alert received | `images/sucessfully_recived_an_email.png` |
| TheHive users created (Indy + SOAR) | `images/creating_2_accounts_on_TheHive_for_shuffle.png` |

> Tip: If you donâ€™t want strict naming, just update the filenames in this README after you upload.

---

## ğŸ” Configuration Details

### 1) Wazuh status and access
Wazuh was confirmed active and running. Access issues in the browser were fixed by allowing inbound HTTPS t
